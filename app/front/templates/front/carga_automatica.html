{% extends "base.html" %}  {% load static %}

{% block content %}
{{ modelFields|json_script:"modelFieldsContext" }}
<script src="{% static 'vendor/xlsx/xlsx.full.min.js' %}"></script>
<script src="{% static 'vendor/papaparse/papaparse.min.js' %}"></script>
<script>
var csrftoken = "{{csrf_token}}";
  const sanitizeDataUrl ="{% url 'subir_archivos:sanitizar_data_grado' %}";
  const loadDataUrl ="{% url 'subir_archivos:load_data' %}";
  
  const academicosSanitizeDataUrl = "{% url 'subir_archivos:sanitizar_data_academico' %}";
  const academicosLoadDataUrl = "{% url 'subir_archivos:load_data_academicos' %}";

  const institucionesSanitizeDataUrl = "{% url 'subir_archivos:sanitizar_data_instituciones' %}";
  const institucionesLoadDataUrl = "{% url 'subir_archivos:load_data_instituciones' %}";
</script>
<!-- TOASTS -->
 <div class="toast align-items-center text-bg-danger border-0" id="error-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000" style="position: fixed; top: 1rem; right: 1rem; z-index: 9999;">
  <div class="d-flex">
    <div id="toast-body" class="toast-body">      
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
  </div>
</div>
<div class="toast align-items-center text-bg-success border-0" id="success-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000" style="position: fixed; top: 4.5rem; right: 1rem; z-index: 9999;">
  <div class="d-flex">
    <div id="success-toast-body" class="toast-body">
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
  </div>
</div>
<!-- modals -->
 <div class="modal fade" id="uploadSummaryModal" tabindex="-1" aria-labelledby="uploadSummaryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadSummaryModalLabel">Resumen de carga</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="uploadSummaryModalBody">
        <!-- Summary will be injected here -->
      </div>
      <div class="modal-footer">
        <p class="text-muted">
        Las <strong>entradas corruptas</strong> pueden revisarse y corregirse posteriormente en la 
        <a href="{% url 'revision:interfaz_revision' %}" class="link-primary" target="_blank" rel="noopener">
          interfaz de revisión
      </a>.
        </p>
      </div>
        <div class="d-flex justify-content-end m-3">  
              <a
                id="btn_export_excel"
                style="cursor:pointer"
                onclick="exportToExcel()"
              >
                Descargar Detalle
                <i class="bi bi-download ms-1"></i>
            </a>

            </div>
    </div>
  </div>
</div>
<div class="d-flex flex-column align-items-center container">
  <div class="container-xxl">
    <div class="d-flex justify-content-between align-items-end">
      <div class="d-flex align-items-end">
        <h2 class="m-0 m-2">Carga por archivo</h2>
      </div>
    </div>
  <hr />
  <p class="fs-6  p-2 m-1 rounded">
    Esta es la sección de carga por archivos. Aquí puedes subir archivos CSV para alimentar la base de datos. Las validaciones y obtención de data externa se realizará automáticamente.<strong> Debes seleccionar si los datos a cargar son de Programas o Académicos</strong>.
  </p>
  <div class="text-center" style="border-bottom: 1px solid #adb5bd">
        <button
          id="grados-section"
          type="button"
          class="btn btn-light query-type-selector me-1 selected p-2"
          onclick="selectSection('grados')"
        >
          Programas
        </button>
        <button
          id="academicos-section"
          type="button"
          class="btn btn-light query-type-selector  btn.disabled p-2"
          onclick="selectSection('academicos')"
        >
          Académicos
        </button>
        <button
          id="instituciones-section"
          type="button"
          class="btn btn-light query-type-selector btn.disabled p-2"
          onclick="selectSection('instituciones')"
        >
          Instituciones
        </button>
      </div>
</div>

<div class="container">
      <div class="row justify-content-center">
        <div class="d-flex justify-content-end">
          <button
              id="plantillas-button"
              class="btn btn-light no-hover"
              style="background-color: inherit; color: inherit; border-color: transparent;"
              onclick="downloadTemplates()"
            >
              Descargar Plantillas
              <i class="bi bi-download ms-1"></i>
            </button>
        </div>
        
        <div class="col-8 position-relative mt-4">
          <div class="progress" role="progressbar" aria-label="Progress" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="height: 1px;">
            <div class="progress-bar bg-danger" style="width: 0%" id="progress-bar"></div>
          </div>
          <button onclick="selectStage(0)" id="progress-circle-1" type="button" class="position-absolute top-0 start-0 translate-middle btn btn-sm btn-danger rounded-pill" style="width: 2rem; height:2rem;">1</button>
          <button onclick="selectStage(1)" disabled id="progress-circle-2" type="button" class="position-absolute top-0 start-50 translate-middle btn btn-sm btn-secondary rounded-pill" style="width: 2rem; height:2rem;">2</button>
          <button onclick="selectStage(2)" disabled id="progress-circle-3" type="button" class="position-absolute top-0 start-100 translate-middle btn btn-sm btn-secondary rounded-pill" style="width: 2rem; height:2rem;">3</button>
        </div>
        <div  class="col-8 position-relative mt-4">
          <span class="position-absolute top-0 start-0 translate-middle mt-1 text-nowrap">Subir Archivo</span>
          <span class="position-absolute top-0 start-50 translate-middle mt-1 text-nowrap">Asociciación de Campos</span>
          <span class="position-absolute top-0 start-100 translate-middle mt-1 text-nowrap" style="left: 100%;">Guardar Programas</span>
        </div>
      </div>
    </div>
    <div id="carga-automatica-info-container" class="container mt-4 px-10">
        <!-- select file stage -->
        <div id="upload-file-stage-content" style="border: 2px dashed #adb5bd; border-radius: 8px; padding: 40px; text-align: center; background: #f8f9fa;">
            <p style="font-size: 18px; color: #495057;">Arrastra y suelta tu archivo aquí o haz clic para seleccionarlo</p>
            <input type="file" id="fileElem" style="display:none" accept=".csv, .xlsx, text/csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/>
            <div class="d-flex flex-column">
            <button type="button" class="btn btn-primary w-auto mx-auto" onclick="document.getElementById('fileElem').click();">Seleccionar archivo</button>
            <span class=""> .csv .xlsx</span>  
            </div>
            <div id="upload-file-stage-file-container" class="mt-3 d-flex justify-content-center align-items-center"></div>
        </div>
        <div id="field-mapping-stage-content" style="display: none;"></div>
        <div id="sanitize-stage-content" style="display: none;"></div>
    </div>
    <!-- Continuar -->
     <div class="container d-flex justify-content-end my-2">
       <button id="continue-button" type="button" class="btn btn-primary" onclick="triggerHeaderMapping()" disabled >Continuar</button>
     </div>     
    </div>
    

<script src="{% static 'front/carga_automatica.js' %}"></script>
{% endblock %}